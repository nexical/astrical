---
/**
 * ItemGrid.astro
 *
 * This component renders a responsive grid of item cards with optional icons, titles,
 * descriptions, and call-to-action buttons. It's designed to display feature lists,
 * FAQ items, or other categorized content in a consistent grid layout.
 *
 * Features:
 * - Responsive grid layout with configurable column counts
 * - Support for icons with default fallback
 * - Rich content with HTML support in titles and descriptions
 * - Optional call-to-action buttons for each item
 * - Themeable styling through CSS classes
 * - Per-item custom styling through classes prop
 * - Accessible structure with proper heading hierarchy
 *
 * Props:
 * - items: Array of Item objects to display in the grid
 *   - title: Item title text (can contain HTML)
 *   - description: Item description text (can contain HTML)
 * - columns: Number of columns in the grid (1, 2, 3, or 4)
 * - defaultIcon: Default icon identifier when item has no icon
 * - classes: Additional CSS classes for styling customization
 *
 * Item Structure:
 * - title: Item title text (can contain HTML)
 * - description: Item description text (can contain HTML)
 * - icon: Optional icon identifier for the item
 * - callToAction: Optional CallToAction object for item-specific action
 * - classes: Optional CSS classes object for per-item styling
 *
 * Styling Inputs:
 * - getClasses('Component+ItemGrid'): Retrieves CSS classes for grid elements
 *   from the theme's style configuration:
 *   - container: Base classes for the grid container
 *   - container_4: Classes for 4-column grid layout
 *   - container_3: Classes for 3-column grid layout
 *   - container_2: Classes for 2-column grid layout
 *   - panel: Classes for individual item card containers
 *   - icon_wrapper: Classes for icon container elements
 *   - icon: Classes for Icon components
 *   - content_wrapper: Classes for content container elements
 *   - title: Classes for item title headings (h3)
 *   - description: Classes for item description paragraphs
 *   - action: Classes for call-to-action button containers
 *
 * Component Integration:
 * - Button: UI button component for call-to-action buttons
 * - Icon: Astro icon component for visual indicators
 * - twMerge: Utility for combining Tailwind classes with theme classes
 * - getClasses: Manages theme-based styling
 * - getComponentClasses: Processes per-item class customizations
 *
 * Data Flow:
 * 1. Receives item array and configuration through Astro.props
 * 2. Processes items to resolve per-item custom classes
 * 3. Renders grid container with responsive column classes
 * 4. Maps through items to create individual item cards
 * 5. Applies theme-based styling with per-item customizations
 * 6. Conditionally renders icons, content, and call-to-action buttons
 *
 * Layout Structure:
 * - Grid container with responsive column layout
 * - Individual item panels containing icon, content, and actions
 * - Icon wrapper positioned above content
 * - Content wrapper with title, description, and optional action
 *
 * Responsive Behavior:
 * - Grid layout adapts based on columns prop
 * - 4-column layout on large screens when columns=4
 * - 3-column layout on medium screens when columns=3
 * - 2-column layout on small screens when columns=2
 * - Single column on mobile devices
 *
 * Accessibility:
 * - Proper heading hierarchy with h3 for item titles
 * - Semantic HTML structure with div containers
 * - Data attributes for test automation
 *
 * Usage Context:
 * - Feature lists in Content and Features widgets
 * - FAQ items in FAQs widget
 * - Statistical items in Stats widget
 * - Any categorized content requiring grid presentation
 */

import type { Item } from '~/types';
import { twMerge } from 'tailwind-merge';
import Button from './Button.astro';
import { Icon } from 'astro-icon/components';
import { getClasses, getComponentClasses } from '~/utils/theme';

/**
 * Component Props Interface
 *
 * @property items - Array of Item objects to display in the grid
 * @property columns - Number of columns in the grid (1, 2, 3, or 4)
 * @property defaultIcon - Default icon identifier when item has no icon
 * @property classes - Additional CSS classes for styling customization
 */
export interface Props {
  items?: Array<Item>;
  columns?: number;
  defaultIcon?: string;
  classes?: Record<string, string>;
}

// Destructure props with defaults
const { items = [], columns, defaultIcon = '', classes: rawClasses = {} } = Astro.props;

// Retrieve CSS classes for grid elements from theme configuration
const classes = getClasses('Component+ItemGrid', rawClasses);

// Process items to resolve per-item custom classes
const resolvedItems = items.map((item) => ({
  ...item,
  resolvedItemClasses: getComponentClasses(item.classes) as Record<string, string>,
}));
---

{
  /*
    Conditional rendering of grid container only when items exist.
    - Checks for items array with length > 0
    - Applies responsive grid classes based on columns prop
    - Merges base container classes with theme classes
    - Includes data attribute for test automation
  */
  items && items.length > 0 && (
    <div
      class={twMerge(
        `${
          columns === 4
            ? classes.container_4
            : columns === 3
              ? classes.container_3
              : columns === 2
                ? classes.container_2
                : ''
        }`,
        classes.container
      )}
      data-name="item-grid-container"
    >
      {
        /*
          Map through resolved items to create individual item cards.
          - Each item contains icon, content, and optional action
          - Applies per-item custom classes when provided
        */
        resolvedItems.map(({ title, description, icon, callToAction, resolvedItemClasses }) => (
          /*
            Item card container (no specific class in current implementation).
            - Wraps individual item panel
          */
          <div>
            {/*
                Item panel container with theme-based styling.
                - Merges base panel classes with per-item custom classes
                - Includes data attribute for test automation
              */}
            <div class={twMerge(classes.panel, resolvedItemClasses?.panel)} data-name="item-grid-panel">
              {/*
                  Icon wrapper container with theme-based styling.
                  - Contains Icon component when icon or defaultIcon exists
                  - Includes data attribute for test automation
                */}
              <div class={classes.icon_wrapper} data-name="item-grid-icon-wrapper">
                {
                  /*
                    Conditional rendering of Icon component.
                    - Uses item icon when provided
                    - Falls back to defaultIcon when no item icon
                    - Merges base icon classes with per-item custom classes
                  */
                  (icon || defaultIcon) && (
                    <Icon name={icon || defaultIcon} class={twMerge(classes.icon, resolvedItemClasses?.icon)} />
                  )
                }
              </div>
              {/*
                  Content wrapper container with theme-based styling.
                  - Contains title, description, and optional action
                  - Includes data attribute for test automation
                */}
              <div class={classes.content_wrapper} data-name="item-grid-content-wrapper">
                {
                  /*
                    Item title heading rendered with HTML content support.
                    - Uses h3 for proper heading hierarchy
                    - Merges base title classes with per-item custom classes
                    - Uses set:html for safe HTML rendering
                    - Includes data attribute for test automation
                  */
                  title && (
                    <h3
                      class={twMerge(classes.title, resolvedItemClasses?.title)}
                      set:html={title}
                      data-name="item-grid-title"
                    />
                  )
                }
                {
                  /*
                    Item description paragraph rendered with HTML content support.
                    - Merges base description classes with per-item custom classes
                    - Uses set:html for safe HTML rendering
                    - Includes data attribute for test automation
                  */
                  description && (
                    <p
                      class={twMerge(classes.description, resolvedItemClasses?.description)}
                      set:html={description}
                      data-name="item-grid-description"
                    />
                  )
                }
                {
                  /*
                    Call-to-action button container rendered when callToAction exists.
                    - Merges base action classes with per-item custom classes
                    - Contains Button component with link variant
                    - Includes data attribute for test automation
                  */
                  callToAction && (
                    <div class={twMerge(classes.action, resolvedItemClasses?.action)} data-name="item-grid-action">
                      <Button variant="link" {...callToAction} />
                    </div>
                  )
                }
              </div>
            </div>
          </div>
        ))
      }
    </div>
  )
}
