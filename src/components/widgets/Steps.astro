---
/**
 * Steps.astro
 *
 * This component renders a step-by-step process widget that displays a sequence of actions
 * or procedures in a timeline format. It's designed to guide users through processes,
 * workflows, or instructional content with optional visual support and call-to-action.
 *
 * Features:
 * - Titled widget structure with optional title, subtitle, and tagline
 * - Timeline-based layout for sequential step presentation
 * - Support for visual content (image or HTML) alongside steps
 * - Reversible layout option for flexible presentation
 * - Call-to-action button for next steps
 * - Themeable styling through CSS classes
 * - Accessible structure with proper labeling
 *
 * Props (extends TitledWidget interface):
 * - id (optional): HTML id attribute for the widget container
 * - title (optional): Widget title (can be passed via slot or prop)
 * - subtitle (optional): Widget subtitle (can be passed via slot or prop)
 * - tagline (optional): Widget tagline (can be passed via slot or prop)
 * - items: Array of step objects representing each process step
 *   - title: Step title or name
 *   - description: Detailed explanation of the step
 *   - icon: Optional icon identifier for visual representation
 *   - classes: Additional CSS classes for the step item
 * - image (optional): Either HTML string or ImageMedia object for visual content
 * - callToAction: Either a string of HTML content or CallToAction object
 * - isReversed (optional): Whether to reverse the content/image layout (defaults to false)
 * - classes (optional): CSS class configuration object
 * - bg (optional): Background image URL string
 *
 * Item Structure (Step):
 * - title: Step title or name
 * - description: Detailed explanation of the step
 * - icon: Optional icon identifier for visual representation
 * - classes: Additional CSS classes for the step item
 *
 * CallToAction Structure:
 * - variant: Button style variant ('primary', 'secondary', 'tertiary', 'link')
 * - text: Button display text
 * - icon: Optional icon identifier
 * - href: URL for link buttons
 * - type: Button type ('button', 'submit', 'reset')
 * - value: Button value attribute
 * - classes: Additional CSS classes for the button
 *
 * ImageMedia Structure:
 * - src: Image source (string path or ImageMetadata object)
 * - alt (optional): Alternative text for the image
 * - href (optional): Link URL for the image
 * - target (optional): Link target attribute (_blank, _self, etc.)
 *
 * Styling Inputs:
 * - getClasses('Component+Steps'): Retrieves CSS classes for steps elements
 *   from the theme's style configuration:
 *   - wrapper: Classes for the WidgetWrapper container
 *   - container: Classes for the main content container
 *   - content: Classes for the steps content column
 *   - headline: Object containing classes for Headline component
 *   - items: Object containing classes for Timeline component
 *   - image_container: Classes for image wrapper container
 *   - image: Classes for Image component
 *   - action_container: Classes for call-to-action container
 *   - action_button: Classes for call-to-action Button component
 *
 * Component Integration:
 * - WidgetWrapper: Provides consistent widget structure
 * - Headline: Renders title, subtitle, and tagline content
 * - Timeline: Renders step items in sequential timeline format
 * - Image: Custom image component for responsive images
 * - Button: UI button component for call-to-action
 * - getClasses: Manages theme-based styling
 *
 * Data Flow:
 * 1. Receives steps configuration through Astro.props
 * 2. Renders headline content through Headline component
 * 3. Displays step items through Timeline component
 * 4. Conditionally renders image content
 * 5. Provides call-to-action button for next steps
 * 6. Wraps content in WidgetWrapper for consistent structure
 * 7. Applies theme-based styling through getClasses utility
 *
 * Layout Structure:
 * - WidgetWrapper provides outer container with background styling
 * - Main container holds content and image columns
 * - Content column contains headline and timeline steps
 * - Image column contains visual support content
 * - Action container holds call-to-action button
 *
 * Responsive Behavior:
 * - Flexible layout that adapts to screen size
 * - Columns stack vertically on mobile devices
 * - Reversible layout option for different presentations
 * - Image uses responsive sizing with multiple breakpoints
 *
 * Accessibility:
 * - Semantic HTML structure through WidgetWrapper
 * - Proper heading hierarchy through Headline component
 * - Sequential step presentation through Timeline component
 * - Data attributes for test automation
 *
 * Usage Context:
 * - Display step-by-step processes or workflows
 * - Guide users through complex procedures
 * - Present instructional content with visual support
 * - Integrated in page sections as a process-focused component
 */

import type { TitledWidget, CallToAction, ImageMedia } from '~/types';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import Timeline from '~/components/ui/Timeline.astro';
import Image from '~/components/ui/Image.astro';
import Button from '~/components/ui/Button.astro';
import { getClasses } from '~/utils/theme';

/**
 * Component Props Interface extending TitledWidget
 *
 * @property items - Array of step objects representing each process step
 * @property image - Either HTML string or ImageMedia object for visual content
 * @property callToAction - Either a string of HTML content or CallToAction object
 * @property isReversed - Whether to reverse the content/image layout (defaults to false)
 */
export interface Props extends TitledWidget {
  items: Array<{
    title: string;
    description?: string;
    icon?: string;
    classes?: Record<string, string>;
  }>;
  image?: string | ImageMedia;
  callToAction?: string | CallToAction;
  isReversed?: boolean;
}

// Destructure props with defaults and slot content rendering
const {
  id,

  // Render slot content for title, subtitle, and tagline if not provided as props
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),

  // Steps configuration with defaults
  items = [],
  image = await Astro.slots.render('image'),
  callToAction = await Astro.slots.render('callToAction'),
  isReversed = false,

  // Styling and background options with defaults
  classes: rawClasses = {},
  bg = '',
} = Astro.props;

// Retrieve CSS classes for steps elements from theme configuration
const classes = getClasses('Component+Steps', rawClasses);
---

{
  /*
    WidgetWrapper provides consistent structure for widget components.
    - Applies theme-based styling through classes.wrapper
    - Supports background styling through bg prop
    - Sets type to "steps" for semantic identification
  */
}
<WidgetWrapper type="steps" id={id} classes={classes.wrapper} bg={bg}>
  {
    /*
      Main container for steps content with flexible layout.
      - Uses conditional classes to reverse layout when isReversed=true
      - Provides responsive flex behavior
      - Includes data-name attribute for test automation
    */
  }
  <div
    class:list={[classes.container, { 'md:flex-row-reverse': isReversed }, { 'md:flex-row': image }]}
    data-name="steps-container"
  >
    {
      /*
        Content column containing headline and timeline steps.
        - Uses conditional classes for responsive sizing based on image presence
        - Includes data-name attribute for test automation
      */
    }
    <div class:list={[classes.content, { 'md:basis-1/2': image }, { 'w-full': !image }]} data-name="steps-content">
      {
        /*
          Headline component renders title, subtitle, and tagline content.
          - Provides consistent heading structure
          - Applies theme-based styling through classes.headline
        */
      }
      <Headline type="steps" title={title} subtitle={subtitle} tagline={tagline} classes={classes.headline} />
      {
        /*
          Timeline component renders step items in sequential format.
          - Displays items as numbered steps with titles and descriptions
          - Applies theme-based styling through classes.items
        */
      }
      <Timeline items={items} classes={classes.items} />
    </div>
    {
      /*
        Image section rendered when image data exists.
        - Supports both HTML content and ImageMedia objects
        - Includes data-name attribute for test automation
      */
      image && (
        /*
          Image container with theme-based styling.
          - Provides consistent sizing and positioning
          - Includes data-name attribute for test automation
        */
        <div class={classes.image_container} data-name="steps-image-container">
          {
            /*
              Conditional rendering based on image data type.
              - String: Render raw HTML content
              - Object: Render Image component with responsive features
            */
            typeof image === 'string' ? (
              /*
                Render raw HTML content when image is a string.
                - Uses Fragment with set:html for safe HTML rendering
              */
              <Fragment set:html={image} />
            ) : (
              /*
                Render Image component when image is an ImageMedia object.
                - Provides responsive image optimization with multiple breakpoints
                - Cover layout with fixed dimensions
                - Applies theme-based styling through classes.image
              */
              <Image
                class={classes.image}
                widths={[400, 768]}
                sizes="(max-width: 768px) 100vw, 432px"
                width={432}
                height={768}
                layout="cover"
                src={image?.src}
                alt={image?.alt || ''}
              />
            )
          }
        </div>
      )
    }
  </div>
  {
    /*
      Call-to-action container with theme-based styling.
      - Provides consistent spacing and positioning for action button
      - Includes data-name attribute for test automation
    */
  }
  <div class={classes.action_container} data-name="steps-action-container">
    {
      /*
        Conditional rendering based on callToAction data type.
        - String: Render raw HTML content
        - Object: Render Button component when text and href exist
      */
      typeof callToAction === 'string' ? (
        /*
          Render raw HTML content when callToAction is a string.
          - Uses Fragment with set:html for safe HTML rendering
        */
        <Fragment set:html={callToAction} />
      ) : (
        /*
          Render Button component when callToAction is an object with text and href.
          - Only renders when both text and href properties exist
          - Applies primary variant by default
          - Applies theme-based styling through classes.action_button
        */
        callToAction &&
        callToAction.text &&
        callToAction.href && <Button variant="primary" {...callToAction} class={classes.action_button} />
      )
    }
  </div>
</WidgetWrapper>
