---
/**
 * Content.astro
 *
 * This component renders a flexible content widget that can display text content,
 * images, feature items, and call-to-action buttons in a responsive grid layout.
 * It's designed to present rich content with optional visual elements and action items.
 *
 * Features:
 * - Titled widget structure with optional title, subtitle, and tagline
 * - Flexible content layout with text, images, and feature items
 * - Responsive grid layout that can be reversed
 * - Support for both HTML content and structured item lists
 * - Optional call-to-action button
 * - Themeable styling through CSS classes
 * - Accessible structure with proper labeling
 *
 * Props (extends TitledWidget interface):
 * - id (optional): HTML id attribute for the widget container
 * - title (optional): Widget title (can be passed via slot or prop)
 * - subtitle (optional): Widget subtitle (can be passed via slot or prop)
 * - tagline (optional): Widget tagline (can be passed via slot or prop)
 * - content (optional): HTML content string for text content
 * - image (optional): Either HTML string or ImageMedia object for visual content
 * - items (optional): Array of Item objects for feature lists
 * - columns (optional): Number of columns for item grid layout
 * - isReversed (optional): Whether to reverse the grid layout (image on left)
 * - callToAction (optional): CallToAction object for action button
 * - classes (optional): CSS class configuration object
 * - bg (optional): Background image URL string
 *
 * Item Structure:
 * - title: Item title text
 * - description: Item description text
 * - icon: Optional icon identifier
 * - classes: Additional CSS classes for the item
 *
 * ImageMedia Structure:
 * - src: Image source (string path or ImageMetadata object)
 * - alt (optional): Alternative text for the image
 * - href (optional): Link URL for the image
 * - target (optional): Link target attribute (_blank, _self, etc.)
 *
 * Styling Inputs:
 * - getClasses('Component+Content'): Retrieves CSS classes for content elements
 *   from the theme's style configuration:
 *   - wrapper: Classes for the TitledWidgetWrapper container
 *   - headline: Classes for the TitledWidgetWrapper container
 *   - container: Classes for the main content container
 *   - grid: Classes for the main grid layout container
 *   - grid_reversed: Classes for reversed grid layout
 *   - column_1: Classes for the text/content column
 *   - column_1_no_image: Classes for text column when no image present
 *   - column_2: Classes for the image column
 *   - content: Classes for the HTML content container
 *   - items: Classes for the ItemGrid component
 *   - image_container: Classes for image wrapper container
 *   - image: Classes for Image component
 *   - call_to_action_container: Classes for CTA button container
 *   - call_to_action: Classes for CTA button wrapper
 *
 * Component Integration:
 * - TitledWidgetWrapper: Provides consistent titled widget structure
 * - Image: Custom image component for responsive images with link support
 * - Button: UI button component for call-to-action
 * - ItemGrid: Component for rendering feature item lists
 * - getClasses: Manages theme-based styling
 *
 * Data Flow:
 * 1. Receives content configuration through Astro.props
 * 2. Renders either HTML content or structured item lists
 * 3. Optionally displays image content in grid layout
 * 4. Wraps content in TitledWidgetWrapper for consistent structure
 * 5. Applies theme-based styling through getClasses utility
 *
 * Layout Structure:
 * - TitledWidgetWrapper provides outer container with title/subtitle
 * - Main grid container holds content and image columns
 * - Content column contains HTML content and item lists
 * - Image column contains visual content
 * - CTA button container at bottom for actions
 *
 * Responsive Behavior:
 * - Grid layout adapts to screen size
 * - Columns stack vertically on mobile
 * - Image can be positioned left or right
 *
 * Accessibility:
 * - Semantic HTML structure through TitledWidgetWrapper
 * - Proper alt attributes for images
 * - aria-hidden for decorative image containers
 * - Data attributes for test automation
 *
 * Usage Context:
 * - Present feature descriptions with supporting visuals
 * - Showcase product capabilities with checklists
 * - Display rich content sections in marketing pages
 * - Integrated in page sections as a versatile content component
 */

import type { TitledWidget, Item, CallToAction, ImageMedia } from '~/types';
import TitledWidgetWrapper from '~/components/ui/TitledWidgetWrapper.astro';
import Image from '~/components/ui/Image.astro';
import Button from '~/components/ui/Button.astro';
import ItemGrid from '~/components/ui/ItemGrid.astro';
import { getClasses } from '~/utils/theme';

/**
 * Component Props Interface extending TitledWidget
 *
 * @property content - HTML content string for text content
 * @property image - Either HTML string or ImageMedia object for visual content
 * @property items - Array of Item objects for feature lists
 * @property columns - Number of columns for item grid layout
 * @property isReversed - Whether to reverse the grid layout (image on left)
 * @property callToAction - CallToAction object for action button
 */
export interface Props extends TitledWidget {
  content?: string;
  image?: string | ImageMedia;
  items?: Array<Item>;
  columns?: number;
  isReversed?: boolean;
  callToAction?: CallToAction;
}

// Destructure props with defaults and slot content rendering
const {
  id,

  // Render slot content for title, subtitle, and tagline if not provided as props
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),

  // Render slot content for content and image if not provided as props
  content = await Astro.slots.render('content'),
  image = await Astro.slots.render('image'),
  items = [],
  columns,
  isReversed = false,
  callToAction,

  // Styling and background options with defaults
  classes: rawClasses = {},
  bg = '',
} = Astro.props;

// Retrieve CSS classes for content elements from theme configuration
const classes = getClasses('Component+Content', rawClasses);
---

{
  /*
    TitledWidgetWrapper provides consistent structure for titled components.
    - Renders title, subtitle, and tagline content
    - Applies theme-based styling through classes.wrapper and classes.headline
    - Supports background styling through bg prop
    - Sets type to "content" for semantic identification
  */
}
<TitledWidgetWrapper
  type="content"
  id={id}
  classes={classes}
  bg={bg}
  title={title}
  subtitle={subtitle}
  tagline={tagline}
>
  {
    /*
      Main container for content widget with theme-based styling.
      - Contains grid layout for content and image
      - Includes data-name attribute for test automation
    */
  }
  <div class={classes.container} data-name="content-container">
    {
      /*
        Main grid container for content and image layout.
        - Uses conditional classes to reverse layout when isReversed=true
        - Provides responsive grid behavior
        - Includes data-name attribute for test automation
      */
    }
    <div class:list={[classes.grid, isReversed ? classes.grid_reversed : '']} data-name="content-grid">
      {
        /*
          Content column that displays text content and item lists.
          - Only rendered when content or items exist
          - Uses different classes based on image presence
          - Includes data-name attribute for test automation
        */
        (content || items) && (
          /*
            First column containing text content and item lists.
            - Uses column_1 when image exists, column_1_no_image when no image
            - Includes data-name attribute for test automation
          */
          <div class={image ? classes.column_1 : classes.column_1_no_image} data-name="content-column-1">
            {
              /*
                HTML content container rendered when content exists.
                - Uses set:html to render HTML content safely
                - Applies theme-based styling through classes.content
                - Includes data-name attribute for test automation
              */
              content && <div class={classes.content} set:html={content} data-name="content" />
            }

            {/*
                ItemGrid component for rendering feature lists.
                - Displays items in configurable grid layout
                - Uses default icon for items without icons
                - Applies theme-based styling through classes.items
              */}
            <ItemGrid items={items} columns={columns} defaultIcon="tabler:check" classes={classes.items} />
          </div>
        )
      }
      {
        /*
          Image column that displays visual content.
          - Only rendered when image data exists
          - Includes data-name attribute for test automation
        */
        image && (
          /*
            Second column containing image content.
            - Marked as aria-hidden since it's decorative
            - Uses theme-based styling through classes.column_2
            - Includes data-name attribute for test automation
          */
          <div aria-hidden="true" class={classes.column_2} data-name="content-column-2">
            {/*
                Image container with theme-based styling.
                - Provides consistent sizing and positioning
                - Includes data-name attribute for test automation
              */}
            <div class={classes.image_container} data-name="content-image-container">
              {
                /*
                  Conditional rendering based on image data type.
                  - String: Render raw HTML content
                  - Object: Render Image component with responsive features
                */
                typeof image === 'string' ? (
                  /*
                    Render raw HTML content when image is a string.
                    - Uses Fragment with set:html for safe HTML rendering
                  */
                  <Fragment set:html={image} />
                ) : (
                  /*
                    Render Image component when image is an ImageMedia object.
                    - Provides responsive image optimization
                    - Supports linking through href and target props
                    - Fixed dimensions with responsive layout
                    - Applies theme-based styling through classes.image
                  */
                  <Image
                    class={classes.image}
                    width={500}
                    height={500}
                    widths={[400, 768]}
                    sizes="(max-width: 768px) 100vw, 432px"
                    layout="responsive"
                    {...image}
                  />
                )
              }
            </div>
          </div>
        )
      }
    </div>

    {
      /*
        Call-to-action button container rendered when callToAction exists.
        - Positioned below the main content grid
        - Includes data-name attribute for test automation
      */
      callToAction && (
        /*
          CTA button container with theme-based styling.
          - Provides consistent spacing and positioning
          - Includes data-name attribute for test automation
        */
        <div class={classes.call_to_action_container} data-name="content-call-to-action-container">
          {/*
              CTA button wrapper with theme-based styling.
              - Contains Button component with link variant
              - Includes data-name attribute for test automation
            */}
          <div class={classes.call_to_action} data-name="content-call-to-action">
            {/*
                Button component configured as link variant.
                - Uses spread operator to pass all callToAction props
                - Provides clear action for user engagement
              */}
            <Button variant="link" {...callToAction} />
          </div>
        </div>
      )
    }
  </div>
</TitledWidgetWrapper>
