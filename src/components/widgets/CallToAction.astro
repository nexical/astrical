---
/**
 * CallToAction.astro
 *
 * This component renders a call-to-action widget that displays a titled section with
 * one or more action buttons. It's designed to encourage user engagement by presenting
 * clear, actionable options in a visually prominent way.
 *
 * Features:
 * - Titled widget structure with optional title, subtitle, and tagline
 * - Support for single or multiple action buttons
 * - Flexible action rendering (Button components or HTML content)
 * - Themeable styling through CSS classes
 * - Accessible structure with proper labeling
 *
 * Props (extends TitledWidget interface):
 * - id (optional): HTML id attribute for the widget container
 * - title (optional): Widget title (can be passed via slot or prop)
 * - subtitle (optional): Widget subtitle (can be passed via slot or prop)
 * - tagline (optional): Widget tagline (can be passed via slot or prop)
 * - actions: Either a string of HTML content or array of CallToAction objects
 *   - When array: Each object configures a Button component
 *   - When string: Rendered as raw HTML content
 * - classes (optional): CSS class configuration object
 * - bg (optional): Background image URL string
 *
 * CallToAction Structure:
 * - variant: Button style variant ('primary', 'secondary', 'tertiary', 'link')
 * - text: Button display text
 * - icon: Optional icon identifier
 * - href: URL for link buttons
 * - type: Button type ('button', 'submit', 'reset')
 * - value: Button value attribute
 * - classes: Additional CSS classes for the button
 *
 * Styling Inputs:
 * - getClasses('Component+CallToAction'): Retrieves CSS classes for CTA elements
 *   from the theme's style configuration:
 *   - wrapper: Classes for the TitledWidgetWrapper container
 *   - headline: Classes for the TitledWidgetWrapper container
 *   - container: Classes for the main CTA content container
 *   - actions_container: Classes for the actions wrapper div
 *   - action_wrapper: Classes for individual action button wrappers
 *   - action_button: Classes for Button component instances
 *
 * Component Integration:
 * - TitledWidgetWrapper: Provides consistent titled widget structure
 * - Button: UI button component for action buttons
 * - getClasses: Manages theme-based styling
 *
 * Data Flow:
 * 1. Receives CTA configuration through Astro.props
 * 2. Renders either Button components or HTML content based on actions type
 * 3. Wraps content in TitledWidgetWrapper for consistent structure
 * 4. Applies theme-based styling through getClasses utility
 *
 * Layout Structure:
 * - TitledWidgetWrapper provides outer container with title/subtitle
 * - Main container holds action buttons or HTML content
 * - Actions container provides layout for multiple buttons
 * - Individual action wrappers for consistent button spacing
 *
 * Accessibility:
 * - Semantic HTML structure through TitledWidgetWrapper
 * - Proper button markup with accessible attributes
 * - Data attributes for test automation
 *
 * Usage Context:
 * - Encourage user signups or purchases
 * - Direct users to important pages or resources
 * - Present clear next steps in user journey
 * - Integrated in page sections as a conversion-focused component
 */

import type { TitledWidget, CallToAction } from '~/types';
import TitledWidgetWrapper from '~/components/ui/TitledWidgetWrapper.astro';
import Button from '~/components/ui/Button.astro';
import { getClasses } from '~/utils/theme';

/**
 * Component Props Interface extending TitledWidget
 *
 * @property actions - Either HTML string content or array of CallToAction objects
 */
interface Props extends TitledWidget {
  actions?: string | CallToAction[];
}

// Destructure props with defaults and slot content rendering
const {
  id,

  // Render slot content for title, subtitle, and tagline if not provided as props
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),

  // Render slot content for actions if not provided as prop
  actions = await Astro.slots.render('actions'),

  // Styling and background options with defaults
  classes: rawClasses = {},
  bg = '',
} = Astro.props;

// Retrieve CSS classes for CTA elements from theme configuration
const classes = getClasses('Component+CallToAction', rawClasses);
---

{
  /*
    TitledWidgetWrapper provides consistent structure for titled components.
    - Renders title, subtitle, and tagline content
    - Applies theme-based styling through classes.wrapper and classes.headline
    - Supports background styling through bg prop
    - Sets type to "call-to-action" for semantic identification
  */
}
<TitledWidgetWrapper
  type="call-to-action"
  id={id}
  classes={classes}
  bg={bg}
  title={title}
  subtitle={subtitle}
  tagline={tagline}
>
  {
    /*
      Main container for CTA content with theme-based styling.
      - Contains actions container for button layout
      - Includes data-name attribute for test automation
    */
  }
  <div class={classes.container} data-name="call-to-action-container">
    {
      /*
        Conditional rendering of actions content.
        - Only renders when actions data is provided
        - Supports both array of buttons and HTML content
      */
      actions && (
        /*
          Actions container with theme-based styling.
          - Provides layout context for action buttons
          - Includes data-name attribute for test automation
        */
        <div class={classes.actions_container} data-name="call-to-action-actions-container">
          {
            /*
              Conditional rendering based on actions data type.
              - Array: Render Button components for each action
              - String: Render raw HTML content
            */
            Array.isArray(actions) ? (
              /*
                Map through actions array to render Button components.
                - Each action configures a Button instance
                - Wrapped in individual action containers
              */
              actions.map((action) => (
                /*
                  Individual action wrapper with theme-based styling.
                  - Provides consistent spacing for buttons
                  - Includes data-name attribute for test automation
                */
                <div class={classes.action_wrapper} data-name="call-to-action-wrapper">
                  {/*
                      Button component configured with action properties.
                      - Uses spread operator to pass all action props
                      - Applies theme-based styling through classes.action_button
                    */}
                  <Button {...(action || {})} class={classes.action_button} />
                </div>
              ))
            ) : (
              /*
                Render raw HTML content when actions is a string.
                - Uses Fragment with set:html for safe HTML rendering
              */
              <Fragment set:html={actions} />
            )
          }
        </div>
      )
    }
  </div>
</TitledWidgetWrapper>
