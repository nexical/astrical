---
/**
 * Steps2.astro
 *
 * This component renders an enhanced step-by-step process widget that displays a sequence of actions
 * or procedures in a two-column layout. It's designed to guide users through processes, workflows,
 * or instructional content with numbered steps and optional icons, presented alongside header content.
 *
 * Features:
 * - Titled widget structure with optional title, subtitle, and tagline
 * - Two-column layout for header content and step presentation
 * - Support for numbered steps with optional icons
 * - Reversible layout option for flexible presentation
 * - Call-to-action button for next steps
 * - Themeable styling through CSS classes
 * - Accessible structure with proper labeling
 *
 * Props (extends TitledWidget interface):
 * - id (optional): HTML id attribute for the widget container
 * - title (optional): Widget title (can be passed via slot or prop)
 * - subtitle (optional): Widget subtitle (can be passed via slot or prop)
 * - tagline (optional): Widget tagline (can be passed via slot or prop)
 * - items: Array of step objects representing each process step
 *   - title: Step title or name
 *   - description: Detailed explanation of the step
 *   - icon: Optional icon identifier for visual representation
 * - callToAction: Either a string of HTML content or CallToAction object
 * - isReversed (optional): Whether to reverse the column layout (defaults to false)
 * - classes (optional): CSS class configuration object
 * - bg (optional): Background image URL string
 *
 * Item Structure (Step):
 * - title: Step title or name
 * - description: Detailed explanation of the step
 * - icon: Optional icon identifier for visual representation
 * - classes: Additional CSS classes for the step item (not used in this component)
 *
 * CallToAction Structure:
 * - variant: Button style variant ('primary', 'secondary', 'tertiary', 'link')
 * - text: Button display text
 * - icon: Optional icon identifier
 * - href: URL for link buttons
 * - type: Button type ('button', 'submit', 'reset')
 * - value: Button value attribute
 * - classes: Additional CSS classes for the button
 *
 * Styling Inputs:
 * - getClasses('Component+Steps2'): Retrieves CSS classes for steps elements
 *   from the theme's style configuration:
 *   - wrapper: Classes for the WidgetWrapper container
 *   - grid: Classes for the main grid layout container
 *   - grid_reversed: Classes for reversed grid layout
 *   - column_1: Classes for the first column (headline and CTA)
 *   - column_1_reversed: Classes for first column in reversed layout
 *   - column_1_normal: Classes for first column in normal layout
 *   - column_2: Classes for the second column (steps list)
 *   - headline: Object containing classes for Headline component
 *   - action_container: Classes for call-to-action container
 *   - action_button: Classes for call-to-action Button component
 *   - items_list: Classes for the steps list container (ul element)
 *   - item: Classes for individual step list items (li elements)
 *   - item_icon_container: Classes for step icon number containers
 *   - item_icon: Classes for step icon/number elements
 *   - icon: Classes for Icon components
 *   - item_content: Classes for step content containers
 *   - item_title: Classes for step title headings (h3 elements)
 *   - item_description: Classes for step description paragraphs
 *
 * Component Integration:
 * - WidgetWrapper: Provides consistent widget structure
 * - Headline: Renders title, subtitle, and tagline content
 * - Button: UI button component for call-to-action
 * - Icon: Astro icon component for step icons
 * - getClasses: Manages theme-based styling
 *
 * Data Flow:
 * 1. Receives steps configuration through Astro.props
 * 2. Renders headline content through Headline component in first column
 * 3. Displays step items as numbered list in second column
 * 4. Conditionally renders icons or step numbers for each step
 * 5. Provides call-to-action button below headline content
 * 6. Wraps content in WidgetWrapper for consistent structure
 * 7. Applies theme-based styling through getClasses utility
 *
 * Layout Structure:
 * - WidgetWrapper provides outer container with background styling
 * - Grid container holds two columns
 * - First column contains headline and call-to-action
 * - Second column contains numbered steps list
 * - Columns can be reversed based on isReversed prop
 *
 * Responsive Behavior:
 * - Grid layout adapts to screen size
 * - Columns stack vertically on mobile devices
 * - Reversible layout option for different presentations
 *
 * Accessibility:
 * - Semantic HTML structure through WidgetWrapper
 * - Proper heading hierarchy through Headline component
 * - Numbered list for sequential step presentation
 * - Data attributes for test automation
 *
 * Usage Context:
 * - Display step-by-step processes or workflows in two-column layout
 * - Guide users through complex procedures with visual separation
 * - Present instructional content with clear step numbering
 * - Integrated in page sections as a process-focused component
 */

import type { TitledWidget, CallToAction } from '~/types';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import Button from '~/components/ui/Button.astro';
import { Icon } from 'astro-icon/components';
import { getClasses } from '~/utils/theme';

/**
 * Component Props Interface extending TitledWidget
 *
 * @property items - Array of step objects representing each process step
 * @property callToAction - Either a string of HTML content or CallToAction object
 * @property isReversed - Whether to reverse the column layout (defaults to false)
 */
export interface Props extends TitledWidget {
  items: Array<{
    title: string;
    description?: string;
    icon?: string;
    classes?: Record<string, string>;
  }>;
  callToAction?: string | CallToAction;
  isReversed?: boolean;
}

// Destructure props with defaults and slot content rendering
const {
  id,

  // Render slot content for title, subtitle, and tagline if not provided as props
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),

  // Steps configuration with defaults
  items = [],
  callToAction = await Astro.slots.render('callToAction'),
  isReversed = false,

  // Styling and background options with defaults
  classes: rawClasses = {},
  bg = '',
} = Astro.props;

// Retrieve CSS classes for steps elements from theme configuration
const classes = getClasses('Component+Steps2', rawClasses);
---

{
  /*
    WidgetWrapper provides consistent structure for widget components.
    - Applies theme-based styling through classes.wrapper
    - Supports background styling through bg prop
    - Sets type to "steps-2" for semantic identification
  */
}
<WidgetWrapper type="steps-2" id={id} classes={classes.wrapper} bg={bg}>
  {
    /*
      Grid container for two-column layout with theme-based styling.
      - Uses conditional classes to reverse layout when isReversed=true
      - Provides responsive grid behavior
      - Includes data-name attribute for test automation
    */
  }
  <div class:list={[classes.grid, isReversed ? classes.grid_reversed : '']} data-name="steps-2-grid">
    {
      /*
        First column containing headline and call-to-action.
        - Uses conditional classes for reversed layout styling
        - Includes data-name attribute for test automation
      */
    }
    <div
      class:list={[classes.column_1, isReversed ? classes.column_1_reversed : classes.column_1_normal]}
      data-name="steps-2-column-1"
    >
      {
        /*
          Headline component renders title, subtitle, and tagline content.
          - Provides consistent heading structure
          - Applies theme-based styling through classes.headline
        */
      }
      <Headline type="steps-2" title={title} subtitle={subtitle} tagline={tagline} classes={classes.headline} />

      {
        /*
          Call-to-action container with theme-based styling.
          - Provides consistent spacing and positioning for action button
          - Includes data-name attribute for test automation
        */
      }
      <div class={classes.action_container} data-name="steps-2-action-container">
        {
          /*
            Conditional rendering based on callToAction data type.
            - String: Render raw HTML content
            - Object: Render Button component when text and href exist
          */
          typeof callToAction === 'string' ? (
            /*
              Render raw HTML content when callToAction is a string.
              - Uses Fragment with set:html for safe HTML rendering
            */
            <Fragment set:html={callToAction} />
          ) : (
            /*
              Render Button component when callToAction is an object with text and href.
              - Only renders when both text and href properties exist
              - Applies primary variant by default
              - Applies theme-based styling through classes.action_button
            */
            callToAction &&
            callToAction.text &&
            callToAction.href && <Button variant="primary" {...callToAction} class={classes.action_button} />
          )
        }
      </div>
    </div>

    {
      /*
        Second column containing the steps list.
        - Uses theme-based styling through classes.column_2
        - Includes data-name attribute for test automation
      */
    }
    <div class={classes.column_2} data-name="steps-2-column-2">
      {
        /*
          Steps list container with theme-based styling.
          - Contains individual step items as list elements
          - Uses ul element for proper semantic structure
          - Includes data-name attribute for test automation
        */
      }
      <ul class={classes.items_list} data-name="steps-2-items-list">
        {
          /*
            Conditional rendering of steps list.
            - Only renders when items array has content
            - Maps through items to create individual step elements
          */
          items && items.length
            ? items.map(({ title: title2, description, icon }, index) => (
                /*
                  Individual step list item with theme-based styling.
                  - Contains icon/number container and content container
                  - Uses li element for proper semantic structure
                  - Includes data-name attribute for test automation
                */
                <li class={classes.item} data-name="steps-2-item">
                  {/*
                      Step icon/number container with theme-based styling.
                      - Contains either custom icon or step number
                      - Includes data-name attribute for test automation
                    */}
                  <div class={classes.item_icon_container} data-name="steps-2-item-icon-container">
                    {/*
                        Step icon/number element with theme-based styling.
                        - Displays custom icon when provided
                        - Displays step number (1-indexed) when no icon
                        - Includes data-name attribute for test automation
                      */}
                    <span class={classes.item_icon} data-name="steps-2-item-icon">
                      {icon ? <Icon name={icon} class={classes.icon} /> : index + 1}
                    </span>
                  </div>
                  {/*
                      Step content container with theme-based styling.
                      - Contains step title and description
                      - Includes data-name attribute for test automation
                    */}
                  <div class={classes.item_content} data-name="steps-2-item-content">
                    {/*
                        Step title heading rendered with HTML content support.
                        - Uses h3 for proper heading hierarchy
                        - Uses set:html for safe HTML rendering
                        - Styled with classes.item_title
                        - Includes data-name attribute for test automation
                      */}
                    <h3 class={classes.item_title} set:html={title2} data-name="steps-2-item-title" />
                    {/*
                        Step description paragraph rendered with HTML content support.
                        - Uses set:html for safe HTML rendering
                        - Styled with classes.item_description
                        - Includes data-name attribute for test automation
                      */}
                    <p class={classes.item_description} set:html={description} data-name="steps-2-item-description" />
                  </div>
                </li>
              ))
            : ''
        }
      </ul>
    </div>
  </div>
</WidgetWrapper>
