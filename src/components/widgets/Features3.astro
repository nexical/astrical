---
/**
 * Features3.astro
 *
 * This component renders an enhanced features widget that displays a collection of feature items
 * alongside a prominent image in a two-column layout. It's designed to showcase product capabilities,
 * services, or key benefits with visual support and optional icons for enhanced presentation.
 *
 * Features:
 * - Titled widget structure with optional title, subtitle, and tagline
 * - Two-column layout with image and feature items
 * - Responsive grid layout for feature items
 * - Support for configurable number of columns
 * - Optional default icon for feature items
 * - Support for both HTML content and image media in the visual section
 * - Themeable styling through CSS classes
 * - Accessible structure with proper labeling
 *
 * Props (extends TitledWidget interface):
 * - id (optional): HTML id attribute for the widget container
 * - title (optional): Widget title (can be passed via slot or prop)
 * - subtitle (optional): Widget subtitle (can be passed via slot or prop)
 * - tagline (optional): Widget tagline (can be passed via slot or prop)
 * - image (optional): Either HTML string or ImageMedia object for visual content
 * - items: Array of Item objects representing feature items
 *   - Item.title: Feature title text
 *   - Item.description: Feature description text
 *   - Item.icon (optional): Icon identifier for the feature
 * - columns: Number of columns for item grid layout
 * - defaultIcon: Default icon identifier for items without icons
 * - classes (optional): CSS class configuration object
 * - bg (optional): Background image URL string
 *
 * Item Structure:
 * - title: Feature title text
 * - description: Feature description text
 * - icon: Optional icon identifier (uses defaultIcon if not provided)
 * - classes: Additional CSS classes for the item
 *
 * ImageMedia Structure:
 * - src: Image source (string path or ImageMetadata object)
 * - alt (optional): Alternative text for the image
 * - href (optional): Link URL for the image
 * - target (optional): Link target attribute (_blank, _self, etc.)
 *
 * Styling Inputs:
 * - getClasses('Component+Features3'): Retrieves CSS classes for feature elements
 *   from the theme's style configuration:
 *   - wrapper: Classes for the TitledWidgetWrapper container
 *   - headline: Classes for the TitledWidgetWrapper container
 *   - container: Classes for the main image container div
 *   - image_container: Classes for the image wrapper div
 *   - image: Classes for the Image component
 *   - items: Object containing classes for ItemGrid items
 *
 * Component Integration:
 * - TitledWidgetWrapper: Provides consistent titled widget structure
 * - ItemGrid: Component for rendering feature items in grid layout
 * - Image: Custom image component for responsive images with link support
 * - getClasses: Manages theme-based styling
 *
 * Data Flow:
 * 1. Receives feature configuration through Astro.props
 * 2. Renders either HTML content or image in the visual section
 * 3. Renders feature items through ItemGrid component
 * 4. Wraps content in TitledWidgetWrapper for consistent structure
 * 5. Applies theme-based styling through getClasses utility
 *
 * Layout Structure:
 * - TitledWidgetWrapper provides outer container with title/subtitle
 * - Main container holds image/content section
 * - ItemGrid renders feature items below the visual section
 * - Items display as title/description pairs with optional icons
 *
 * Responsive Behavior:
 * - Image section is displayed as decorative element
 * - Grid layout adapts to screen size based on columns prop
 * - Flexible column count for different device sizes
 *
 * Accessibility:
 * - Semantic HTML structure through TitledWidgetWrapper
 * - Proper heading hierarchy for feature titles
 * - aria-hidden for decorative image container
 * - Data attributes for test automation
 *
 * Usage Context:
 * - Showcase product features with supporting visual context
 * - Present service offerings with illustrative examples
 * - Highlight key benefits with visual reinforcement
 * - Integrated in page sections as a feature-focused component with visual support
 */

import type { TitledWidget, Item, ImageMedia } from '~/types';
import TitledWidgetWrapper from '~/components/ui/TitledWidgetWrapper.astro';
import ItemGrid from '~/components/ui/ItemGrid.astro';
import Image from '~/components/ui/Image.astro';
import { getClasses } from '~/utils/theme';

/**
 * Component Props Interface extending TitledWidget
 *
 * @property image - Either HTML string or ImageMedia object for visual content
 * @property items - Array of Item objects representing feature items
 * @property columns - Number of columns for item grid layout
 * @property defaultIcon - Default icon identifier for items without icons
 */
export interface Props extends TitledWidget {
  image?: string | ImageMedia;
  items?: Array<Item>;
  columns?: number;
  defaultIcon?: string;
}

// Destructure props with defaults and slot content rendering
const {
  id,

  // Render slot content for title, subtitle, and tagline if not provided as props
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),

  // Visual content and feature items with defaults
  image,
  items = [],
  columns,
  defaultIcon,

  // Styling and background options with defaults
  classes: rawClasses = {},
  bg = '',
} = Astro.props;

// Retrieve CSS classes for feature elements from theme configuration
const classes = getClasses('Component+Features3', rawClasses);
---

{
  /*
    TitledWidgetWrapper provides consistent structure for titled components.
    - Renders title, subtitle, and tagline content
    - Applies theme-based styling through classes.wrapper and classes.headline
    - Supports background styling through bg prop
    - Sets type to "features-3" for semantic identification
  */
}
<TitledWidgetWrapper
  type="features-3"
  id={id}
  classes={classes}
  bg={bg}
  title={title}
  subtitle={subtitle}
  tagline={tagline}
>
  {
    /*
      Main container for image/content section with theme-based styling.
      - Marked as aria-hidden since it's decorative
      - Contains image or HTML content
      - Includes data-name attribute for test automation
    */
  }
  <div aria-hidden="true" class={classes.container} data-name="features-3-container">
    {
      /*
        Conditional rendering of image/content section.
        - Only rendered when image data exists
        - Supports both HTML content and ImageMedia objects
      */
      image && (
        /*
          Image container with theme-based styling.
          - Provides consistent sizing and positioning
          - Includes data-name attribute for test automation
        */
        <div class={classes.image_container} data-name="features-3-image-container">
          {
            /*
              Conditional rendering based on image data type.
              - String: Render raw HTML content
              - Object: Render Image component with responsive features
            */
            typeof image === 'string' ? (
              /*
                Render raw HTML content when image is a string.
                - Uses Fragment with set:html for safe HTML rendering
              */
              <Fragment set:html={image} />
            ) : (
              /*
                Render Image component when image is an ImageMedia object.
                - Provides responsive image optimization
                - Supports linking through href and target props
                - Full width layout with auto width and fixed height
                - Applies theme-based styling through classes.image
              */
              <Image
                class={classes.image}
                width="auto"
                height={320}
                widths={[400, 768]}
                layout="fullWidth"
                {...image}
              />
            )
          }
        </div>
      )
    }
  </div>

  {
    /*
      ItemGrid component renders feature items in configurable grid layout.
      - Displays items in specified number of columns
      - Uses provided defaultIcon or theme default for items without icons
      - Applies theme-based styling to items through classes.items
    */
  }
  <ItemGrid items={items} columns={columns} defaultIcon={defaultIcon} classes={classes.items} />
</TitledWidgetWrapper>
